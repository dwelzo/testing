# Pytest Configuration Guide

## Overview

Pytest can be configured using several methods:

1. `pytest.ini` (recommended)

## Current Configuration (pytest.ini)

Your current `pytest.ini` file contains:

```ini
[tool:pytest]
testpaths = tests
python_files = test_*.py *_test.py
python_classes = Test*
python_functions = test_*
addopts =
    -v
    --strict-markers
    --strict-config
    --tb=short
    --cov=app
    --cov-report=term-missing
    --cov-report=html:htmlcov
    --cov-fail-under=80
markers =
    unit: Unit tests
    integration: Integration tests
    slow: Slow running tests
    database: Tests that require database
    api: API endpoint tests

filterwarnings =
    ignore::UserWarning
    ignore::DeprecationWarning
    
env_files =
    .env
    .env.test
```

## Configuration Options Explained

### Test Discovery

- **`testpaths`**: Directories to search for tests
- **`python_files`**: Patterns for test file names
- **`python_classes`**: Patterns for test class names
- **`python_functions`**: Patterns for test function names

### Command Line Options (`addopts`)

- **`-v`**: Verbose output
- **`--strict-markers`**: Treat unregistered markers as errors
- **`--strict-config`**: Treat unregistered config options as errors
- **`--tb=short`**: Short traceback format
- **`--cov=app`**: Enable coverage for 'app' directory
- **`--cov-report=term-missing`**: Show missing lines in terminal
- **`--cov-report=html:htmlcov`**: Generate HTML coverage report
- **`--cov-fail-under=80`**: Fail if coverage is below 80%

### Custom Markers

Define custom markers to categorize tests:

```ini
markers =
    unit: Unit tests
    integration: Integration tests
    slow: Slow running tests
    database: Tests that require database
    api: API endpoint tests
```

Usage in tests:

```python
@pytest.mark.unit
def test_add():
    pass

@pytest.mark.slow
def test_large_operation():
    pass
```

### Filter Warnings

```ini
filterwarnings =
    ignore::UserWarning
    ignore::DeprecationWarning
```

### Environment Files

Your configuration also includes:

```ini
env_files =
    .env
    .env.test
```

## Your Current Setup

You are using `pytest.ini` configuration file, which is the **recommended approach** for pytest configuration. This file is:

-  **Project-specific**: Only applies to this project
-  **Pytest-only**: Dedicated configuration file for pytest
-  **Well-documented**: Clear INI format that's easy to read
-  **Version-controlled**: Part of your repository

### Why pytest.ini is Better Than pyproject.toml for Testing

1. **Dedicated purpose**: pytest.ini is specifically for pytest configuration
2. **Simpler syntax**: INI format is more readable for configuration
3. **No conflicts**: Won't interfere with other tools' configuration
4. **Pytest-first**: Recognized by pytest as the primary configuration method

Your setup follows pytest best practices!

## Common Configuration Options

### Basic Settings

```ini
# Minimum python version
minversion = 6.0

# Test timeout (requires pytest-timeout)
timeout = 300

# Parallel execution (requires pytest-xdist)
addopts = -n auto

# Only run tests that failed last time
addopts = --lf

# Exit after first failure
addopts = -x
```

### Coverage Settings

```ini
# Coverage configuration
addopts =
    --cov=src
    --cov=tests
    --cov-branch
    --cov-report=term-missing
    --cov-report=html:htmlcov
    --cov-report=xml
    --cov-fail-under=90
```

### Output Control

```ini
addopts =
    -v                    # verbose
    -s                    # no capture (print statements show)
    --tb=short           # short traceback
    --tb=long            # detailed traceback
    --tb=no              # no traceback
    --no-header          # no header
    --quiet              # minimal output
```

### Test Selection

```ini
# Only run tests with specific markers
addopts = -m "not slow"

# Run tests matching pattern
addopts = -k "test_add"

# Run specific test file
addopts = tests/test_calculator.py
```

## Environment Variables

You can also configure pytest using environment variables:

```bash
export PYTEST_ADDOPTS="-v --tb=short"
export PYTEST_CURRENT_TEST="test_file.py::test_function"
```

## Running with Different Configurations

### Command Line Override

```bash
# Override configuration temporarily
pytest -v --tb=long --cov=app tests/

# Use specific config file
pytest -c custom_pytest.ini

# Ignore config file
pytest -o addopts=""
```

### Common Commands with Your Setup

Based on your current configuration:

```bash
# Run all tests (uses pytest.ini settings)
pytest

# Run specific test file
pytest tests/test_main.py

# Run with specific marker
pytest -m unit

# Run without coverage
pytest --no-cov

# Run with different coverage threshold
pytest --cov-fail-under=90

# Generate only HTML report
pytest --cov-report=html

# Run in quiet mode
pytest -q
```

## Best Practices

1. **Use pytest.ini for project-specific settings**
2. **Define custom markers for test categorization**
3. **Set appropriate coverage thresholds**
4. **Use meaningful marker names**
5. **Document your markers**
6. **Keep configuration simple and readable**

## Troubleshooting

### Common Issues

1. **Tests not found**: Check `testpaths` and file patterns
2. **Markers not recognized**: Add them to `markers` section
3. **Coverage not working**: Ensure pytest-cov is installed
4. **Import errors**: Check `pythonpath` settings

### Debug Configuration

```bash
# Show configuration
pytest --collect-only

# Show markers
pytest --markers

# Show help
pytest --help
```

Your current setup is well-configured for a typical Python project with good coverage reporting and test organization!
