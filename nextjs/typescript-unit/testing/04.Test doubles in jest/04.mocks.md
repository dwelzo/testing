

## üí° What Is a Mock?

A **mock** is a **test double** that not only replaces a real function,
but also **records information** about how it was used ‚Äî
like *was it called*, *how many times*, and *with what arguments*.

> Think of a mock like a security camera ‚Äî it watches how your function behaves.

---

## üß© Example Setup (Functions Only)

Let‚Äôs keep it simple again:

### üìÑ `email.ts`

```typescript
export function sendEmail(to: string, subject: string, body: string): string {
  console.log(`üìß Real email sent to ${to}`);
  return "Email sent successfully";
}
```

### üìÑ `user.ts`

```typescript
import { sendEmail } from "./email";

export function registerUser(name: string, email: string): string {
  if (!email) throw new Error("Email required");

  sendEmail(email, "Welcome!", `Hi ${name}, welcome!`);
  return `User ${name} registered`;
}
```

---

## ‚ùå Without Mock (Real Call)

```typescript
import { registerUser } from "../app/user";

test("registerUser without mock", () => {
  const result = registerUser("Alice", "alice@example.com");
  expect(result).toBe("User Alice registered");
});
```

üß† Problem:

* Real `sendEmail()` executes
* Console log appears (side effect)
* You **can‚Äôt verify** if it was called correctly

---

## ‚úÖ With Mock

Now let‚Äôs use a Jest mock to replace and **observe** `sendEmail()`.

### üìÑ `user.mock.test.ts`

```typescript
import * as emailModule from "../app/email";
import { registerUser } from "../app/user";

test("registerUser() calls sendEmail() with correct arguments", () => {
  // 1Ô∏è‚É£ Mock the sendEmail function
  const mockSendEmail = jest.spyOn(emailModule, "sendEmail").mockReturnValue("Email sent successfully");

  // 2Ô∏è‚É£ Call function under test
  const result = registerUser("Bob", "bob@example.com");

  // 3Ô∏è‚É£ Check result
  expect(result).toBe("User Bob registered");

  // 4Ô∏è‚É£ Verify interaction (mock behavior)
  expect(mockSendEmail).toHaveBeenCalledTimes(1);
  expect(mockSendEmail).toHaveBeenCalledWith(
    "bob@example.com",
    "Welcome!",
    expect.stringContaining("Bob")
  );

  // 5Ô∏è‚É£ Clean up mock
  jest.restoreAllMocks();
});
```

---

### üß† What Happened

| Step                       | Behavior                                           |
| -------------------------- | -------------------------------------------------- |
| `jest.spyOn()`             | Creates a **mock wrapper** around `sendEmail()`    |
| `.mockReturnValue()`       | Makes it return fake data instead of real behavior |
| `.toHaveBeenCalledWith()`  | Verifies that the mock was called correctly        |
| `.toHaveBeenCalledTimes()` | Ensures it was called exactly once                 |

‚úÖ No real email is sent
‚úÖ No console log appears
‚úÖ You can verify *how* it was used

---

## üß™ You Can Also Use a Pure Mock Function

If you don‚Äôt even need the real module,
you can create a **standalone mock** like this:

```typescript
test("registerUser() using pure mock function", () => {
  const mockSendEmail = jest.fn().mockReturnValue("Email sent successfully");

  // Replace real function with mock
  jest.mock("../app/email", () => ({
    sendEmail: mockSendEmail,
  }));

  const { registerUser } = require("../app/user");

  const result = registerUser("Charlie", "charlie@example.com");

  expect(mockSendEmail).toHaveBeenCalledWith(
    "charlie@example.com",
    "Welcome!",
    expect.any(String)
  );

  expect(result).toBe("User Charlie registered");
});
```

---

## üß≠ Difference Between Stub and Mock

| Type     | Purpose                                 | Checks Interaction? | Example                     |
| -------- | --------------------------------------- | ------------------- | --------------------------- |
| **Stub** | Returns fake data                       | ‚ùå No                | `.mockReturnValue()`        |
| **Mock** | Returns fake data **and** tracks calls  | ‚úÖ Yes               | `.toHaveBeenCalledWith()`   |
| **Spy**  | Wraps a real function but watches calls | ‚úÖ Yes               | `jest.spyOn(obj, "method")` |

---

## üß© Simple Analogy

Imagine testing a **Pizza Order** system:

| Role      | What it does           | Example                                              |
| --------- | ---------------------- | ---------------------------------------------------- |
| **Dummy** | Just fills a parameter | A blank ‚Äúaddress‚Äù                                    |
| **Stub**  | Returns fixed response | `pizzaPrice()` always returns 10                     |
| **Mock**  | Records behavior       | Check if `sendOrder()` was called with ‚Äúlarge pizza‚Äù |

---

## üßæ Summary Code Overview

| Type      | Jest Example                             |
| --------- | ---------------------------------------- |
| **Dummy** | `new DummyEmailService()` or `{}`        |
| **Stub**  | `jest.spyOn(...).mockReturnValue("OK")`  |
| **Mock**  | `expect(mock).toHaveBeenCalledWith(...)` |
| **Spy**   | `jest.spyOn(obj, "method")`              |


